2025-02-18 22:17
Tags: #jwt

---

–≠—Ç–æ –æ–±—ã—á–Ω–∞—è –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π**, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏

![[jwt_2.png]]

---
### Header (–ó–∞–≥–æ–ª–æ–≤–æ–∫)

- –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–∫–µ–Ω–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ (`alg`) –∏ —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ (`typ`).
- –ö–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ **Base64Url**.

–ü—Ä–∏–º–µ—Ä:
```JSON
{
  "alg": "HS256",
  "typ": "JWT"
}
```

---
### Payload (–ü–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)

- –°–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ (–∫–ª–∞–π–º—Å—ã, claims), –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç:
	- **Registered claims** (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è (`iss` ‚Äì –∫—Ç–æ –≤—ã–¥–∞–ª, `exp` ‚Äì —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ç. –¥.).
	- **Public claims** (–æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ) ‚Äì –ª—é–±—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `userId`, `role`).
	- **Private claims** (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ) ‚Äì —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ.
- –¢–∞–∫–∂–µ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ **Base64Url**.

–ü—Ä–∏–º–µ—Ä:
```JSON
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true,
  "exp": 1716239022
}
```

---

### Signature (–ü–æ–¥–ø–∏—Å—å)

- –ó–∞—â–∏—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (RSA, ECDSA), —Ç–æ –ø–æ–¥–ø–∏—Å—å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞.

–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫:
```js
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)
```

---

**–ü–æ–ª–Ω—ã–π JWT –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9
.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

–õ—é–±–∞—è —á–∞—Å—Ç—å, –∫—Ä–æ–º–µ –ø–æ–¥–ø–∏—Å–∏, –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –∑–Ω–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞.

---

### üîê –ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å:

1. –ë–µ—Ä—ë—Ç—Å—è **–∑–∞–≥–æ–ª–æ–≤–æ–∫** –∏ **–ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞**, –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ **Base64Url**.
2. –≠—Ç–∏ –¥–≤–µ —á–∞—Å—Ç–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É (`.`):
```js
base64UrlEncode(header) + "." + base64UrlEncode(payload)
```
3. –ü–æ–ª—É—á–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
	- HMAC (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á): `HMACSHA256(data, secret)`
	- RSA (–∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á):  `RSASHA256(data, privateKey)`
	- ECDSA (—ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏–≤—ã–µ, –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á): `ECDSASHA256(data, privateKey)`
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ **Base64Url** –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ JWT.

---

### üîç –ö–∞–∫ –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

–ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç JWT:
1. –û–Ω –±–µ—Ä—ë—Ç **–∑–∞–≥–æ–ª–æ–≤–æ–∫** –∏ **payload**, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ Base64Url.
2. –ó–∞–Ω–æ–≤–æ –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—å, –∏—Å–ø–æ–ª—å–∑—É—è **—Ç–æ—Ç –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º** –∏ **—Å–µ–∫—Ä–µ—Ç**.
3. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–æ–π, —á—Ç–æ –≤ —Ç–æ–∫–µ–Ω–µ, –∑–Ω–∞—á–∏—Ç JWT **–Ω–µ –±—ã–ª –ø–æ–¥–¥–µ–ª–∞–Ω**.

---

### üõ° –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å JWT?

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **HTTPS**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞.
- –í—ã–±–∏—Ä–∞—Ç—å **–Ω–∞–¥—ë–∂–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º** (–Ω–µ `none`, –Ω–µ —Å–ª–∞–±—ã–µ `HS256` –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –ø–æ —Å–µ—Ç–∏).
- **–•—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `.env`).
- **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ (`exp`)**, —á—Ç–æ–±—ã —É–∫—Ä–∞–¥–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤–µ—á–Ω–æ.
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Refresh Tokens** –≤–º–µ—Å—Ç–æ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö JWT.

---


![[JWT.jpg]]

---
#### –ï—Å—Ç—å –¥–≤–∞ –≤–∏–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤:
- Access - —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
- Refresh - –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç access —Ç–æ–∫–µ–Ω

![[JWT_token.jpg]]

---
### Links
[[Base/Node.js/Node.js]]
