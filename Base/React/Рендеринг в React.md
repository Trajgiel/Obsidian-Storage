2025-03-02 23:02
Tags: #React #рендерингВReact

Процесс рендеринга React-компонент. Что мы видим в браузере, можно разделить на несколько этапов.

---

### 1. **Компиляция TypeScript (TSX → JS)**

- `.tsx` код преобразуется в JavaScript с помощью Babel или другого компилятора.
- JSX транспилируется в вызовы `React.createElement`.

---

### 2. **Создание Fiber Tree**

- Когда React начинает рендерить компонент, он создает **Fiber Tree** — древовидную структуру, представляющую все компоненты и их состояния.
- Каждый узел дерева — это fiber node, который содержит:
    - Тип компонента (например, `<div>` или пользовательский компонент).
    - Пропсы.
    - Состояние.
    - Ссылки на родительские и дочерние фиберы.

---

### 3. **Reconciliation (Сверка)**

- Fiber делит процесс сверки на два подэтапа: **Render Phase** и **Commit Phase** .

##### a) **Render Phase (Фаза Рендера)**

- На этом этапе React:
    1. Создает или обновляет Fiber Tree.
    2. Выполняет логику компонентов (например, функциональные компоненты или методы классовых компонентов).
    3. Вычисляет необходимые изменения в DOM.
- Render Phase может быть разделена на несколько частей (chunks), чтобы не блокировать основной поток браузера.
- Если появляются высокоприоритетные задачи (например, пользовательский ввод), React может приостановить текущую работу и переключиться на более важные задачи.

##### b) **Commit Phase (Фаза Фиксации)**

- После завершения Render Phase React переходит к Commit Phase.
- На этом этапе React:
    1. Обновляет реальный DOM.
    2. Вызывает эффекты (`useEffect`, `componentDidMount`, `componentDidUpdate`).
    3. Обрабатывает ошибки (если они есть)

---

### 4. **Обновление Реального DOM**

- После того как Fiber Tree готов, React применяет минимальные изменения к реальному DOM.
- Благодаря Fiber, эти изменения выполняются эффективно и могут быть разделены на части, если это необходимо.

---

### 5. **[Рендеринг Браузером](Рендеринг%20в%20браузере)**

- После обновления реального DOM браузер выполняет стандартные этапы рендеринга:
    1. **HTML → DOM**
    2. **CSS → CSSOM**
    3. ** Render Tree (DOM + CSSOM)**
    4. **Layout (расчет позиций и размеров)**
    5. **Paint (рисование элементов)**
    6. **Compositing (компоновка слоев)**

---

### 6. **Приоритеты и Preemption (Прерывание)**

- Fiber позволяет React управлять приоритетами задач:
    - **High Priority** : Пользовательский ввод, анимации, обновления состояния.
    - **Low Priority** : Фоновые задачи, такие как загрузка данных.
- Если высокоприоритетная задача появляется во время выполнения низкоприоритетной, React может приостановить низкоприоритетную задачу и переключиться на более важную.

---
### Links
[[Base/React/React]]
