2025-02-25 20:54
Tags: #TreeShaking

Это процесс удаления неиспользуемого кода (dead code elimination) из вашего проекта во время сборки. Это помогает уменьшить размер финального бандла, что особенно важно для веб-приложений, где каждый лишний байт может влиять на производительность.

---

### Как работает Tree shaking:

 1. **Статический анализ кода** : Tree shaking возможен благодаря статическому анализу кода, который выполняется на этапе сборки. Сборщики, такие как Webpack, Rollup или Vite, могут определить, какие части кода действительно используются в приложении, а какие нет.
 2. **Использование ES модулей (ESM)** : Для того чтобы tree shaking работал корректно, код должен быть написан с использованием ES модулей (`import`/`export`). Это позволяет сборщику точно определить зависимости и понять, какие части кода не используются.
 3. **Удаление мертвого кода** : После анализа сборщик удаляет все неиспользуемые экспортные значения, функции или переменные из конечного бандла.

---

### Почему это важно:

- **Оптимизация размера бандла** : Уменьшение размера JavaScript-файлов приводит к более быстрой загрузке страницы и лучшей производительности.
- **Снижение сложности поддержки** : Чем меньше кода нужно загружать, тем проще его поддерживать и отлаживать.

---

### Ограничения Tree shaking:

1. **Не работает с CommonJS** : Если вы используете CommonJS (`require`), tree shaking не сможет работать, так как CommonJS динамический и не позволяет провести статический анализ.
2. **Сторонние библиотеки** : Если сторонняя библиотека не экспортирует свои функции через ES модули, tree shaking также не сможет удалить неиспользуемый код из этой библиотеки.
3. **Динамические импорты** : Если вы используете динамические импорты (например, `import()`), tree shaking может не сработать, так как сборщик не может заранее знать, какие модули будут импортированы.

---

### sideEffects

Флаг `sideEffects` в файле `package.json` используется для указания сборщику (например, Webpack, Rollup или Vite), какие файлы в вашем пакете содержат побочные эффекты (side effects). Это важно для корректной работы механизма **tree shaking** , который удаляет неиспользуемый код из вашего проекта.

- **Если `sideEffects` не указан** , сборщик считает, что все файлы в пакете имеют побочные эффекты, и поэтому он **не сможет безопасно применять tree shaking** ко всем файлам.
- **Если вы явно укажете `"sideEffects": false`** , вы сообщите сборщику, что **все файлы в вашем пакете чистые (pure)** , и он может безопасно удалять неиспользуемый код из них.
- **Если вы укажете массив файлов/шаблонов в `sideEffects`** , вы явно перечислите те файлы, которые содержат побочные эффекты, а остальные файлы будут считаться чистыми.

---
### Links
[[JavaScript]]
